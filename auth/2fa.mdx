---
title: Two-factor authentication
---

# Two-factor authentication (2FA)

Flowxi supports **TOTP** (Google Authenticator, Authy, etc.).

2FA is optional and user-controlled.

---

## Enrollment model (important)

- Enrollment secret is **generated in cache**
- Secret is **never stored in DB** until verified
- DB commit happens **only after `/enable` succeeds**

This prevents ghost 2FA states.

---

## Get 2FA status

`GET /api/v1/auth/2fa/status`

### If enabled

- `enabled: true`
- no secret
- no QR code

### If disabled

- `enabled: false`
- `secret`
- `otpauth_uri`
- `expires_in`

---

## Enable 2FA

`POST /api/v1/auth/2fa/enable`

- Verifies code against **pending secret**
- Commits secret to DB
- Does **not** revoke sessions

---

## Disable 2FA

`POST /api/v1/auth/2fa/disable`

- Verifies code against DB secret
- Clears secret
- Forces fresh enrollment next time

---

## Step-up verification

`POST /api/v1/auth/2fa/verify`

Used to prove 2FA for sensitive actions.

- Does not issue token
- Updates `twofa_last_verified_at`

---

## Login with 2FA

1. `/auth/login` → challenge
2. `/auth/2fa/verify-login`
3. Token issued after verification

---

## Security constraints

- Rate-limited enable/disable
- Max attempts enforced
- TOTP tolerance ±1 interval
- Challenge bound to IP + User-Agent
