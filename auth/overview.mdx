---
title: Authentication overview
---

# Authentication overview

Flowxi uses **Laravel Sanctum** personal access tokens (`Bearer`) for authentication.

Authentication is designed for:
- strict anti-enumeration
- device-level sessions
- optional 2FA with step-up verification

---

## Tokens

Successful authentication returns:

- `access_token`
- `token_type: Bearer`

All protected endpoints require:

```http
Authorization: Bearer <access_token>
```

---

## Supported authentication flows

### Registration

- Magic link (email + password setup)
- Email code (OTP) + password

### Login

- Email + password
- Optional TOTP-based 2FA challenge

---

## Device-based sessions

Flowxi enforces:

- **1 token per `device_id`**
- New login on same device **revokes previous token**
- Other devices remain active

---

## High-level login flow

1. Client calls `/auth/login`
2. If 2FA disabled → token issued
3. If 2FA enabled → challenge returned
4. Client verifies via `/auth/2fa/verify-login`
5. Token issued after successful TOTP

---

## Security guarantees

- Strict anti-enumeration
- Rate-limited auth attempts
- MFA challenges bound to IP + User-Agent
- Hard challenge expiration (no extension)
- Localization applied before any response

---

## Protected session endpoints

- `POST /auth/logout`
- `POST /auth/logout-device`
- `GET /auth/devices`

---

## 2FA management

- Enrollment via pending secret (cache only)
- Secret committed to DB only after verification
- No forced logout on enable/disable
- Step-up verification supported

