---
title: Errors
---

# Errors

Flowxi returns **structured, predictable JSON errors** designed for
**frontend control**, **anti-enumeration**, and **bank-level UX consistency**.

Each error contains:

- a stable machine-readable `code`
- a localized human-readable `message`
- optional structured details (`errors`)

---

## Global error format

### Standard error

```json
{
  "message": "Human readable message",
  "code": "ERROR_CODE"
}
```

### Validation error (422)

```json
{
  "message": "Some fields are invalid.",
  "code": "VALIDATION_FAILED",
  "errors": {
    "email": ["The email must be a valid email address."]
  }
}
```

---

## Localization

Error messages are localized using the same locale resolution as the rest of the API:

1. `X-App-Locale`
2. `Accept-Language`
3. `user.locale`
4. fallback `fr`

`code` values are **never localized**.

---

## HTTP status semantics

| Status | Meaning                       | Frontend action                    |
|------|-------------------------------|------------------------------------|
| 422  | Validation failed              | Show inline field errors            |
| 401  | Unauthenticated                | Clear token, redirect to login      |
| 403  | Forbidden / invalid code       | Stay in flow, show message          |
| 404  | Resource not found             | Show not-found state                |
| 409  | Conflict                       | Suggest next step                   |
| 410  | MFA challenge expired          | Restart login                       |
| 429  | Rate limited                   | Disable action, show cooldown       |
| 500  | Server error                   | Show generic retry UI               |

---

## Authentication errors (anti-enumeration)

### Invalid credentials

Returned for:
- unknown email
- wrong password
- non-active account

```json
{
  "message": "Invalid credentials.",
  "code": "INVALID_CREDENTIALS"
}
```

Frontend must **never infer which condition failed**.

---

## MFA-specific errors

| Code                    | Meaning                          |
|-------------------------|----------------------------------|
| `MFA_REQUIRED`          | 2FA challenge required           |
| `MFA_CHALLENGE_GONE`    | Challenge expired or missing     |
| `MFA_CHALLENGE_INVALID` | Challenge binding mismatch       |
| `MFA_CODE_INVALID`      | Wrong TOTP code                  |
| `MFA_TOO_MANY_ATTEMPTS` | Brute-force protection triggered |

---

## Registration errors

| Code                    | Meaning                    |
|-------------------------|----------------------------|
| `EMAIL_ALREADY_USED`    | Email already active       |
| `EMAIL_ALREADY_ACTIVE`  | Account already activated  |
| `USER_NOT_FOUND`        | No user for resend flow    |
| `OTP_INVALID`           | Invalid or expired code    |

---

## Frontend best practices

- Always branch on `code`
- Treat `429` as UX requirement, not error
- Never display raw backend stack info
- Never leak account existence

---

## Testing checklist

- Verify same response for wrong email vs wrong password
- Trigger validation errors and check `errors`
- Trigger rate limits and ensure UI cooldown
- Test MFA expiration paths
